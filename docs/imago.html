<!DOCTYPE html>  <html> <head>   <title>imago.rb</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="config.html">                 config.rb               </a>                                           <a class="source" href="imago.html">                 imago.rb               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               imago.rb             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Requires</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Write out all requires from gems</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="sx">%w(rubygems sinatra imgkit aws/s3 digest/md5 haml redis open-uri RMagick json airbrake newrelic_rpm sinatra/jsonp)</span><span class="o">.</span><span class="n">each</span><span class="p">{</span> <span class="o">|</span><span class="n">g</span><span class="o">|</span> <span class="nb">require</span> <span class="n">g</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>require the app configs</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="n">require_relative</span> <span class="s1">&#39;config&#39;</span>
<span class="kp">include</span> <span class="no">Magick</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>GET /get_image?</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>/get_image?</code> takes a list of params.
The list of params are (all are required):</p>

<ul>
<li><p><code>website</code>: the url you wish to screenshot. Do not include http/https.
url should be encoded. (e.g. www.example.com)</p></li>
<li><p><code>width</code>: the width of the screen shot. (e.g. 600)</p></li>
<li><p><code>height</code>: the height of the screenshot. (e.g. 600)</p></li>
<li><p><code>format</code>: the format to respond with. Accepted values are html, json, and image.
Use image to inline images (e.g. <code>&lt;img src="/get_image?format=image" /&gt;</code>)</p></li>
</ul>

<p><em>EXAMPLE</em>:</p>

<p>/get_image?website=www.example.com&amp;width=600&amp;height=600&amp;format=image</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="n">get</span> <span class="s1">&#39;/get_image?&#39;</span> <span class="k">do</span>
  
  <span class="vi">@errors</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

  <span class="k">if</span> <span class="vi">@errors</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;website&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Hash the params to get the filename and the key for redis</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nb">name</span> <span class="o">=</span> <span class="no">Digest</span><span class="o">::</span><span class="no">MD5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;website&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;width&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;height&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Try to lookup the hash to see if this image has been created before</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@link</span> <span class="o">=</span> <span class="no">REDIS</span><span class="o">.</span><span class="n">get</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">unless</span> <span class="vi">@link</span>
      <span class="k">begin</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Create tmp directory if it doesn't exist</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="n">temp_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">settings</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/tmp&quot;</span>
        <span class="no">Dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span> <span class="k">unless</span> <span class="no">Dir</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
        </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Capture the screenshot</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="n">kit</span>   <span class="o">=</span> <span class="no">IMGKit</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">quality</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="mi">1280</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">720</span> <span class="p">)</span>
        
        <span class="n">temp_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">.jpg&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Resize the screengrab using rmagick</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="n">img</span> <span class="o">=</span> <span class="no">Image</span><span class="o">.</span><span class="n">from_blob</span><span class="p">(</span><span class="n">kit</span><span class="o">.</span><span class="n">to_img</span><span class="p">(</span><span class="ss">:jpg</span><span class="p">))</span><span class="o">.</span><span class="n">first</span>
        <span class="n">thumb</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize_to_fill</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;width&#39;</span><span class="o">].</span><span class="n">to_i</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;height&#39;</span><span class="o">].</span><span class="n">to_i</span><span class="p">)</span>
        <span class="n">thumb</span><span class="o">.</span><span class="n">write</span> <span class="n">temp_file</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Store the image on s3.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="n">send_to_s3</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Create the link.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="vi">@link</span> <span class="o">=</span> <span class="s2">&quot;https://d29sc4udwyhodq.cloudfront.net/</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">.jpg&quot;</span>
      <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">exception</span>
        <span class="vi">@link</span> <span class="o">=</span> <span class="s2">&quot;https://d29sc4udwyhodq.cloudfront.net/not_found.jpg&quot;</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Save in redis for re-use later.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="no">REDIS</span><span class="o">.</span><span class="n">set</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="vi">@link</span>
      <span class="no">REDIS</span><span class="o">.</span><span class="n">expire</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1209600</span>
    <span class="k">end</span>
  <span class="k">else</span>
    <span class="vi">@link</span> <span class="o">=</span> <span class="s2">&quot;https://d29sc4udwyhodq.cloudfront.net/not_found.jpg&quot;</span>
  <span class="k">end</span>
  
  <span class="n">respond</span><span class="p">(</span><span class="vi">@link</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>respond</h3>

<ul>
<li><p><code>link</code>: the final link to the image.</p></li>
<li><p><code>params</code>: the params that were sent with the request.</p></li>
</ul>

<p>Respond to request</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">def</span> <span class="nf">respond</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
  <span class="vi">@link</span> <span class="o">=</span> <span class="n">link</span>
  <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;format&#39;</span><span class="o">]</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Respond based on format</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;format&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span>
      <span class="n">haml</span> <span class="ss">:main</span>
    <span class="k">elsif</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;format&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span>
      <span class="n">content_type</span> <span class="ss">:json</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:link</span> <span class="o">=&gt;</span> <span class="vi">@link</span><span class="p">,</span> <span class="ss">:website</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;website&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
      <span class="no">JSONP</span> <span class="n">data</span>      <span class="c1"># JSONP is an alias for jsonp method</span>
    <span class="k">elsif</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;format&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;image&quot;</span> 
      <span class="vi">@link</span> <span class="o">=</span> <span class="vi">@link</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">,</span> <span class="s1">&#39;http://&#39;</span><span class="p">)</span>
      <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="vi">@link</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>get only header data</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">head</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">uri</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
        <span class="n">http</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">request_uri</span><span class="p">)</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>set headers accordingly (all that apply)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">headers</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="n">head</span><span class="o">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">]</span>
      <span class="n">headers</span> <span class="s1">&#39;Cache-Control&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;max-age=2592000, no-transform, public&quot;</span>
      <span class="n">headers</span> <span class="s1">&#39;Expires&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Thu, 29 Sep 2022 01:22:54 GMT+00:00&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>stream back the contents</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="n">stream</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
        <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> 
          <span class="n">f</span><span class="o">.</span><span class="n">read_body</span> <span class="p">{</span> <span class="o">|</span><span class="n">ch</span><span class="o">|</span> <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">ch</span> <span class="p">}</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Default to json if no format.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">content_type</span> <span class="ss">:json</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:link</span> <span class="o">=&gt;</span> <span class="vi">@link</span><span class="p">,</span> <span class="ss">:website</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;website&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
    <span class="no">JSONP</span> <span class="n">data</span>      <span class="c1"># JSONP is an alias for jsonp method</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>validate</h3>

<ul>
<li><code>params</code>: the params that were sent with the request.</li>
</ul>

<p>Validate the params sent with the request.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
  <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Make sure the website is a passed in param.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;website&#39;</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="n">given?</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;website&#39;</span><span class="o">]</span><span class="p">)</span>
    <span class="n">errors</span><span class="o">[</span><span class="s1">&#39;website&#39;</span><span class="o">]</span>   <span class="o">=</span> <span class="s2">&quot;This field is required&quot;</span>
  <span class="k">end</span>
  </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Make sure the width is a passed in param.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;width&#39;</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="n">given?</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;width&#39;</span><span class="o">]</span><span class="p">)</span>
    <span class="n">errors</span><span class="o">[</span><span class="s1">&#39;width&#39;</span><span class="o">]</span>   <span class="o">=</span> <span class="s2">&quot;This field is required&quot;</span>
  <span class="k">end</span>
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Make sure the height is a passed in param.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;height&#39;</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="n">given?</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;height&#39;</span><span class="o">]</span><span class="p">)</span>
    <span class="n">errors</span><span class="o">[</span><span class="s1">&#39;height&#39;</span><span class="o">]</span>   <span class="o">=</span> <span class="s2">&quot;This field is required&quot;</span>
  <span class="k">end</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Make sure the format is a passed in param.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;format&#39;</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="n">given?</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;format&#39;</span><span class="o">]</span><span class="p">)</span>
    <span class="n">errors</span><span class="o">[</span><span class="s1">&#39;format&#39;</span><span class="o">]</span>   <span class="o">=</span> <span class="s2">&quot;This field is required&quot;</span>
  <span class="k">end</span>

  <span class="n">errors</span>
<span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h3>given?</h3>

<ul>
<li><code>field</code>: the param field to check.</li>
</ul>

<p>Check that a field is not empty</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">def</span> <span class="nf">given?</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
  <span class="o">!</span><span class="n">field</span><span class="o">.</span><span class="n">empty?</span>
<span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3>send<em>to</em>s3</h3>

<ul>
<li><p><code>file</code>: the tmp path to the image file.</p></li>
<li><p><code>name</code>: the name to use for the file.</p></li>
</ul>

<p>Store the image on s3.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">def</span> <span class="nf">send_to_s3</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
  <span class="no">AWS</span><span class="o">::</span><span class="no">S3</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">establish_connection!</span><span class="p">(</span>
                                      <span class="ss">:access_key_id</span>     <span class="o">=&gt;</span> <span class="n">settings</span><span class="o">.</span><span class="n">s3_key</span><span class="p">,</span>
                                      <span class="ss">:secret_access_key</span> <span class="o">=&gt;</span> <span class="n">settings</span><span class="o">.</span><span class="n">s3_secret</span>
                                    <span class="p">)</span>
  <span class="no">AWS</span><span class="o">::</span><span class="no">S3</span><span class="o">::</span><span class="no">S3Object</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">,</span>
                            <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">),</span>
                            <span class="n">settings</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span>
                            <span class="ss">:access</span> <span class="o">=&gt;</span> <span class="ss">:public_read</span>
                          <span class="p">)</span>
<span class="k">end</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 